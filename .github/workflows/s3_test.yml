name: Uploading code to S3
on:
  pull_request:
    # types:
    #   - closed
    # branches: [ "main"]

jobs:
  build-and-deploy:
    if: ((${{ github.event_name == 'pull_request'}}) and (${{github.event.pull_request.merged }} == true))
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v3

      - name: Sync files to S3
        run: |
          echo "=============== list modified files ==============="
          if [[ "$(git rev-parse HEAD)" == "$(git rev-parse --abbrev-ref HEAD)" ]]; then
            git log --pretty=format:%n --name-only --max-count=1
          else
            git diff --name-only HEAD^ HEAD
          fi
